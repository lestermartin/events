
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Dataflow foundations</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14" ga4id=""></google-codelab-analytics>
  <google-codelab codelab-gaid="G-JMQBYBQE82"
                  codelab-ga4id=""
                  id="dataflow-foundations"
                  title="Dataflow foundations"
                  environment="web"
                  feedback-link="https://datavolo.io/contact-us/">
    
      <google-codelab-step label="Tutorial overview" duration="1">
        <p><strong>Last Updated:</strong> 2024-07-25</p>
<h2 is-upgraded><strong>Background</strong></h2>
<p>At <a href="https://datavolo.io/" target="_blank">Datavolo</a>, we are here to help you become a <strong>10x Data Engineer for AI</strong>. Our <a href="https://datavolo.io/product/" target="_blank">product</a> is powered by <a href="https://nifi.apache.org/" target="_blank">Apache NiFi</a>; an easy to use, powerful, and reliable system to process and distribute data. </p>
<p>Before you begin building multimodal data <a href="https://datavolo.io/2024/03/data-engineering-for-advanced-rag-small-to-big-with-pinecone-langchain-and-datavolo/" target="_blank">pipelines to fuel your Advanced RAG</a> applications, it is important to make sure you understand the fundamentals of working with Datavolo flow builder and its component types.</p>
<h2 is-upgraded><strong>Scope of the tutorial</strong></h2>
<p>In this tutorial, you will learn about Datavolo&#39;s fundamental building blocks and how to use the UI to assemble a dataflow. You&#39;ll have a simple, but fully functional, pipeline running on Datavolo&#39;s cloud hosted environment by the end of the tutorial. </p>
<h2 is-upgraded><strong>Learning objectives</strong></h2>
<p>Once you&#39;ve completed this tutorial, you will be able to:</p>
<ul>
<li>Explain the function of the major component types; processors, connections, and FlowFiles.</li>
<li>Construct a dataflow/pipeline with these components.</li>
<li>Control the run-time lifecycle of your dataflow.</li>
<li>Perform simple debugging and interrogation of FlowFiles in your pipeline.</li>
<li>Utilize product documentation for components.</li>
</ul>
<h2 is-upgraded><strong>Prerequisites</strong></h2>
<ul>
<li>A <a href="https://docs.datavolo.io/docs/product/datavolo-cloud" target="_blank">Datavolo Cloud</a> account. <em>See </em><a href="http://localhost:9090/datavolo-cloud" target="_blank"><em>Datavolo Cloud: Getting started</em></a><em>.</em></li>
<li><em>Optionally,</em> writable access to an AWS S3 bucket.</li>
</ul>
<h2 is-upgraded><strong>About Datavolo tutorials</strong></h2>
<p>Datavolo tutorials are designed to get you up and running quickly by providing guided, hands-on educational resources. </p>


      </google-codelab-step>
    
      <google-codelab-step label="Prepare for the scenario" duration="4">
        <h2 is-upgraded>Review the use case</h2>
<p>This initial pipeline will solve a specific one-time function, but could be generalized to be a continuously running dataflow. We will follow the generally understood Extract - Transform - Load (ETL) pattern and perform the following logic.</p>
<h3 is-upgraded><strong>Extract</strong></h3>
<p>The dataflow will retrieve a <a href="https://github.com/lestermartin/events/raw/main/data/xevent/WillShakespeare.zip" target="_blank">zip file</a> that contains the works of William Shakespeare.</p>
<h3 is-upgraded><strong>Transform</strong></h3>
<p>The dataflow will unzip the file to individually work on each included file – it willfilter out any non-text files for additional investigation.</p>
<p>For the text files, classify them as one of the following sizes based on their content&#39;s byte count.</p>
<ul>
<li><code>small</code> – when file size is &lt;= 75 KB</li>
<li><code>medium</code> – files &gt; 75 KB and &lt;= 150 KB</li>
<li><code>large</code> – any file &gt; 150 KB</li>
</ul>
<h3 is-upgraded><strong>Load</strong></h3>
<p><em>Optionally,</em> save the files to an S3 bucket using the content size classifications.</p>
<h2 is-upgraded><strong>Connect to a runtime</strong></h2>
<aside class="special"><p><strong>Note:</strong> If needed, check out <a href="http://localhost:9090/datavolo-cloud" target="_blank">Datavolo Cloud: Getting started</a> to create an account.</p>
</aside>
<p>Once logged into Datavolo Cloud, the <strong>Runtimes</strong> page will be presented. From here you can connect to an existing runtime or create a new one.</p>
<h3 is-upgraded><strong>Existing runtime</strong></h3>
<p>If you, or someone else, have previously created a runtime for your use, simply click on its <strong>NAME</strong> (<strong>simple flow</strong> in the screenshot below for example) to launch it.</p>
<p class="image-container"><img style="width: 624.00px" src="img/fd37b97ffb0c8c8a.png"></p>
<h3 is-upgraded><strong>Create a runtime</strong></h3>
<p>To create a new runtime, click on the <strong>+</strong> sign on the far right of the page to launch the <strong>Create Runtime</strong> form. Add a <strong>Runtime Name</strong> and press <strong>Create</strong> at the bottom of the form. Leave <strong>Node type</strong> and <strong>Maximum nodes</strong> set to their default settings.</p>
<p class="image-container"><img style="width: 624.00px" src="img/747347f3143ca6ec.png"></p>
<p>The new runtime will be listed as <strong>Creating</strong> initially.</p>
<p class="image-container"><img style="width: 624.00px" src="img/264e8c166440acd3.png"></p>
<p>Wait until this changes to <strong>Active</strong> and then click on the name (ex: <strong>simple flow</strong>) on the left.</p>
<p class="image-container"><img style="width: 624.00px" src="img/c1fb40812195e20f.png"></p>
<h2 is-upgraded><strong>Create a process group</strong></h2>
<p>You are now viewing the Datavolo UI. The large grid area that is likely empty, is called the <strong>canvas</strong> and is the home for the components we will be creating to implement our use case.</p>
<p class="image-container"><img style="width: 624.00px" src="img/2ff240c1521c3fe5.png"></p>
<p>Drag and drop the third icon, <strong>Process Group</strong>, from the tool palette at the top of the page onto the canvas.</p>
<p class="image-container"><img style="width: 614.00px" src="img/f38b524012aad9f.png"></p>
<p>Once you release your pointer, a <strong>Create Process Group</strong> pop-up will appear. Add a <strong>Name</strong> and click <strong>Add</strong>.</p>
<p class="image-container"><img style="width: 383.50px" src="img/324bf030c2e9255f.png"></p>
<p>Right click on the new <strong>Process Group</strong> and select <strong>Enter Group</strong> on the contextual menu (or just double click on the <strong>Process Group</strong>).</p>
<p class="image-container"><img style="width: 462.50px" src="img/9002019e2dfd7247.png"></p>
<p>You have created a visual abstraction away from the top-level of the canvas which will allow us to focus on just this tutorial.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Understand NiFi concepts" duration="7">
        <h2 is-upgraded><strong>Definitions</strong></h2>
<p><a href="https://docs.datavolo.io/docs/about-dv/what-is-nifi" target="_blank">What is Apache NiFi? | Datavolo Documentation</a> says it best by simply stating, &#34;NiFi is a powerful enterprise-grade dataflow management tool that supports any and all complex, multimodal data types and a wide variety of data sources and destinations.&#34; This same document identifies these fundamental concepts.</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>FlowFile</strong></p>
</td><td colspan="1" rowspan="1"><p>A FlowFile represents each object moving through the system and for each one, NiFi keeps track of a map of key/value pair attribute strings and its associated content of zero or more bytes.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Processor</strong></p>
</td><td colspan="1" rowspan="1"><p>Processors actually perform the work including activities such as data routing, transformation, or mediation between systems. Processors can operate on zero or more FlowFiles in a given unit of work.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>Connection</strong></p>
</td><td colspan="1" rowspan="1"><p>Connections provide the actual linkage between processors. These act as queues and allow various processes to interact.</p>
</td></tr>
</table>
<aside class="special"><p><strong>Note:</strong> The <a href="https://nifi.apache.org/documentation/v2/" target="_blank">Documentation for Version 2 - Apache NiFi</a> site is the definitive source for NiFi concepts, components, and interactions. The most useful sections are the first 4 listed in the <strong>General</strong> section.</p>
<p class="image-container"><img style="width: 234.00px" src="img/3f9668de00ed6bcd.png"></p>
</aside>
<h2 is-upgraded><strong>In action</strong></h2>
<p>Let&#39;s understand by doing. Return to your empty canvas.</p>
<h3 is-upgraded><strong>Add a processor</strong></h3>
<p>Hover your pointer over the first tool in the palette to see the <strong>Processor</strong> tooltip that surfaces.</p>
<p class="image-container"><img style="width: 298.00px" src="img/32f17687939de95a.png"></p>
<p>Click on the <strong>Processor</strong> tool and drag it onto the canvas and release your click. This will surface an <strong>Add Processor</strong> pop-up window. Type <code>http</code> in the <strong>Filter types</strong> search box in the upper right corner of this pop-up window, select <strong>InvokeHTTP</strong> in the updated list, and then click the <strong>Add</strong> link in the lower right corner.</p>
<p class="image-container"><img style="width: 624.00px" src="img/b7b89d0752419e92.png"></p>
<p>You selected this processor type as the use case is driving us to pull a zip file from a web link. The processor will be used to fulfill our Extract requirements. The canvas will now have this processor on it.</p>
<p class="image-container"><img style="width: 624.00px" src="img/3f1469d2be4bebe9.png"></p>
<h3 is-upgraded><strong>Configure the processor</strong></h3>
<p>Right click on the <strong>InvokeHTTP</strong> processor on your canvas to see a contextual menu and select <strong>View Documentation</strong>.</p>
<p class="image-container"><img style="width: 502.00px" src="img/f0404d59254fcdb8.png"></p>
<p>You should now see the documentation page for this processor type. The <strong>Description</strong> initially states that it &#34;can interact with a configurable HTTP Endpoint&#34; using a configurable destination URL. Find that required property in the <strong>Properties</strong> list of the documentation.</p>
<p class="image-container"><img style="width: 624.00px" src="img/c349b45bfab019d0.png"></p>
<p>Click on <strong>Back to Processor</strong> link in the upper left corner to return to the canvas.</p>
<p class="image-container"><img style="width: 159.00px" src="img/2bcf1da118782d0d.png"></p>
<p>Double click on the processor to enter the <strong>Edit Processor</strong> pop-up window and select the <strong>Properties</strong> tab and update the empty <strong>HTTP URL</strong> value to the following.</p>
<pre><code>https://github.com/lestermartin/events/raw/main/data/xevent/WillShakespeare.zip</code></pre>
<p class="image-container"><img style="width: 624.00px" src="img/b9c025cc38cef794.png"></p>
<aside class="warning"><p><strong>Caution:</strong> When we allow this processor to execute later in this tutorial, it will run multiple times. This is the normal desired behavior of this processor which would be to continually Extract additional data to be processed. For this scenario, you will be shown later how to invoke it to run only once as needed. To help reinforce this need, we will make a few configuration changes to help keep this in mind.</p>
</aside>
<p><em>The concept of scheduling is out of scope for this initial tutorial,</em> but essentially it is the configuration of how and when this processor should be invoked. Click on the <strong>Scheduling</strong> tab and modify <strong>Run Schedule</strong> from <code>0 sec</code> to <code>5 min</code>. </p>
<p class="image-container"><img style="width: 505.00px" src="img/673a92502ba13d8f.png"></p>
<p>To help remind us of this concern later, click on the <strong>Settings</strong> tab and prefix the <strong>Name</strong> field with <code>RUN ONCE</code> and finally click on <strong>Apply</strong> to save the configuration changes.</p>
<p class="image-container"><img style="width: 624.00px" src="img/b5f36cd4e2e11b88.png"></p>
<h3 is-upgraded><strong>Add a second processor</strong></h3>
<p>As before, add another processor to the canvas. Since we are expecting a zip file to be retrieved in the initial processor, this time type <code>UnpackContent</code> in the <strong>Filter types</strong> search box and select the <strong>Type</strong> with the same name. Arrange the second processor below the original one. </p>
<h3 is-upgraded><strong>Create a connection</strong></h3>
<p>Hover over the initial <strong>InvokeHTTP</strong> processor to notice a circle with an arrow inside that appears in the middle of the processor.</p>
<p class="image-container"><img style="width: 387.00px" src="img/cb000c9e4f3948cd.png"></p>
<p>Click on the circle with the arrow inside and drag the pointer towards the bottom processor. It will initially create a <strong>red dotted line</strong> which indicates it is not ready to make a connection.</p>
<p class="image-container"><img style="width: 404.00px" src="img/5e030cba7f753d01.png"></p>
<p>Once the pointer is over the second processor, the dotted line will turn <strong>green</strong> and a <strong>green border</strong> will appear around the processor the connection is being made to.</p>
<p class="image-container"><img style="width: 406.00px" src="img/eb492d065ce429c1.png"></p>
<p>Release the mouse to see the <strong>Create Connection</strong> pop-up window and notice the <strong>From Processor</strong> and <strong>To Processor</strong> names. Check the <strong>Response</strong> box under <strong>Relationships</strong> and then click on <strong>Add</strong> to create the connection.</p>
<p class="image-container"><img style="width: 539.50px" src="img/d06e1c7c797d1c61.png"></p>
<p>The connection is backed by a queue of FlowFiles that houses them until the next processor receives it. This queue is empty right now as we have not started any processing yet. </p>
<p class="image-container"><img style="width: 389.00px" src="img/8ddce655d0432a8d.png"></p>
<h2 is-upgraded><strong>Relationships?</strong></h2>
<p>We will be discussing what a &#34;relationship&#34; is more fully in a future step of this tutorial, but at its simplest a relationship is the opportunity to create a connection between processors. That means data in the system flows through them. The following table is from the <strong>InvokeHTTP</strong> documentation that we surfaced earlier and acts as an example of what we are discussing.</p>
<p class="image-container"><img style="width: 624.00px" src="img/8d5e0e41942462f.png"></p>
<aside class="special"><p><strong>Note:</strong> You already made a connection for the <strong>Response</strong> relationship between the processors. To allow us to begin executing the <strong>InvokeHTTP</strong> processor, we need to either make connections to each of the remaining relationships OR we can &#34;auto-terminate&#34; them. That would mean that we chose to not see any data flowing down any of those particular relationships.</p>
</aside>
<p>Open the <strong>Edit Processor</strong> configuration window for the <strong>InvokeHTTP</strong> processor and navigate to the <strong>Relationships</strong> tab. Check the <strong>terminate</strong> box for the <strong>Failure</strong>, <strong>No Retry</strong>, <strong>Original</strong>, and <strong>Retry</strong> (you will have to scroll down to see <strong>Retry</strong>) relationships. Click <strong>Apply</strong> to return to the canvas.</p>
<p class="image-container"><img style="width: 624.00px" src="img/ca861f7f0bf8909e.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Start the pipeline" duration="4">
        <h2 is-upgraded><strong>Not just dev-time</strong></h2>
<p>By this point, it might not be evident that the Datavolo UI melds dev-time and run-time into a live &amp; interactive experience. You can initialize processing in the same UI as you have already been defining your data pipeline in.</p>
<p>In fact, each processor can be started (and stopped) individually from every other one. The component status bar is showing us, via the <strong>red square icon</strong>, that we have a single processor in a stopped mode. It also shows us we have another processor that is invalid (the <strong>yellow triangle</strong>). </p>
<p class="image-container"><img style="width: 237.00px" src="img/624a5e85ad43112e.png"></p>
<p>This status bar details the status of the whole canvas which only contains the two processors we have added so far. You can see these status indicators on the processors themselves.</p>
<p class="image-container"><img style="width: 407.00px" src="img/4713267bc5d2e63e.png"></p>
<aside class="warning"><p><strong>Caution:</strong> If your <strong>InvokeHTTP</strong> processor is still showing a <strong>yellow triangle</strong>, then it is still invalid. Hover over the <strong>yellow triangle</strong> to see a tooltip declaring what is still invalid.</p>
<p class="image-container"><img style="width: 610.00px" src="img/dec894de4e10258a.png"></p>
<p>The example above shows that the <strong>Retry</strong> relationship is the concern. If you encounter this problem, refer back to the end of the prior step as the <strong>Retry</strong> relationship can only be seen by scrolling down in the configuration screen.</p>
</aside>
<h2 is-upgraded><strong>Begin processing</strong></h2>
<p>Let&#39;s start the initial <strong>InvokeHTTP</strong> processor whose job it is to go to the configured URL and retrieve the zip file we are expecting. Right click on the processor and choose <strong>Run Once</strong> on the context menu that surfaces.</p>
<aside class="warning"><p><strong>Caution:</strong> As mentioned earlier, we do not want to allow this processor to run over and over as it will simply retrieve the same zip file many times. Do NOT choose <strong>Start</strong>. If you do, please immediately right click again and choose <strong>Stop</strong>.</p>
</aside>
<p class="image-container"><img style="width: 487.00px" src="img/ba0a2404d010c9c.png"></p>
<aside class="special"><p><strong>Note:</strong> Verify that a <strong>red square</strong> is next to the <strong>InvokeHTTP</strong> processor name indicating that it is not running.</p>
</aside>
<h2 is-upgraded><strong>Identify FlowFiles</strong></h2>
<p>In a short period of time, you will notice that the <strong>InvokeHTTP</strong> processor is reporting in the processor&#39;s <strong>Out</strong> metric that it has emitted 1 FlowFile of 2.14 MB in size. That same FlowFile is now in the queue that backs the connection named <strong>Response</strong> leaving this processor.</p>
<p class="image-container"><img style="width: 403.00px" src="img/6591c8b85305b385.png"></p>
<p>It is queued because the connection is going to a processor that is not running yet.</p>
<aside class="special"><p><strong>Note:</strong> Right click on an empty area of the canvas for a contextual menu whose first item is <strong>Refresh</strong> and includes a keyboard shortcut. This can be used as needed instead of waiting for the canvas to refresh metrics on its own.</p>
<p class="image-container"><img style="width: 229.00px" src="img/4049532e26fbe00b.png"></p>
</aside>
<p>As a reminder, a FlowFile is like an envelope that contains a reference to the actual binary data that makes up the object flowing through the data pipeline (in this scenario, the one we are currently seeing is a zip file) AND attributes about the object. Here are a few of the attributes that will be present.</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>filename</strong></p>
</td><td colspan="1" rowspan="1"><p>A filename that can be used to store the data to a local or remote file system.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>uuid</strong></p>
</td><td colspan="1" rowspan="1"><p>A Universally Unique Identifier that distinguishes the FlowFile from other FlowFiles in the system.</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>fileSize</strong></p>
</td><td colspan="1" rowspan="1"><p>The number of bytes taken up by the FlowFile&#39;s content.</p>
</td></tr>
</table>
<p>Right click on the <strong>Response</strong> connection&#39;s queue and click on <strong>List Queue</strong> from the context menu.</p>
<p class="image-container"><img style="width: 491.00px" src="img/a202c1bdc728628e.png"></p>
<p>You will now see the single FlowFile listed that was retrieved by the <strong>InvokeHTTP</strong> processor.</p>
<p class="image-container"><img style="width: 624.00px" src="img/7013195ec9190833.png"></p>
<h2 is-upgraded><strong>View attributes</strong></h2>
<p>Click on the <strong>vertical ellipsis</strong> to the far right of the entry and select <strong>View Details</strong>.</p>
<p class="image-container"><img style="width: 321.00px" src="img/d754fc193bfa43c7.png"></p>
<p>You will see the <strong>Details</strong> tab of the <strong>FlowFile </strong>pop-up window. The initial information under the <strong>FlowFile Details</strong> heading references the 3 attributes previously mentioned; <strong>filename</strong>, <strong>fileSize</strong>, and <strong>uuid</strong>. On your own, click on the <strong>Attributes</strong> tab and find these same 3 attributes along with all attributes present for this FlowFile.</p>
<p class="image-container"><img style="width: 523.00px" src="img/5b95fc32d928adc8.png"></p>
<h2 is-upgraded><strong>View content</strong></h2>
<p>Click on Click on the <strong>Download</strong> button at the bottom of the previous screenshot to save a copy of the file on your workstation. Add a <code>.zip</code> extension to the filename and verify there are 43 files inside the unzipped folder.</p>
<p class="image-container"><img style="width: 624.00px" src="img/8847c3523361b98f.png"></p>
<p>Optionally, explore the files in the unzipped folder.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Unzip the file" duration="5">
        <p>The next step in the dataflow is to unzip the file that the FlowFile is tied to using the <strong>UnpackContent</strong> processor we added earlier.</p>
<h2 is-upgraded><strong>Relationships</strong></h2>
<p>It might seem logical to just &#34;start&#34; the second processor now, but if you right click on it you will notice there is no option to do so. This is because it is marked as invalid – notice the <strong>yellow triangle</strong> next to its name. Hover over that icon and the issues that make it invalid will surface in a tooltip.</p>
<p class="image-container"><img style="width: 618.00px" src="img/dcd481eff3dc102.png"></p>
<p>All 3 of these problems are essentially the same. They are stating that various &#34;relationships&#34; are invalid because they are &#34;not connected to any component&#34; or &#34;not auto-terminated&#34;.</p>
<p>Here are the descriptions of the <strong>Relationships</strong> from the <strong>UnpackContent</strong> processor documentation. Reminder; right click on the processor and select <strong>View Documentation</strong>.</p>
<p class="image-container"><img style="width: 624.00px" src="img/855d0c431f33a435.png"></p>
<p>These &#34;relationships&#34; are basically the streams of information that a processor can emit FlowFiles into.  All processors produce at least one relationship. Double click on the processor to pull up the <strong>Edit Processor</strong> pop-up and select the <strong>Relationships</strong> tab to see the list of the 3 relationships the <strong>UnpackContent</strong> processor produces; <strong>failure</strong>, <strong>original</strong>, and <strong>success</strong>. These are the same from the documentation.</p>
<p class="image-container"><img style="width: 624.00px" src="img/5e6b02b71ff5481.png"></p>
<aside class="special"><p><strong>Note:</strong> There is no specific requirement for relationship names for a given outcome, but the 3 above are very commonly used.</p>
</aside>
<p>If the <strong>original</strong> FlowFile was useful in the dataflow for any other purpose, we could create a connection to another processor for that. As we don&#39;t need it, go ahead and auto-terminate it. </p>
<p>As we are NOT trying to make a perfect robust solution in this initial example, check the <strong>terminate</strong> box next to the <strong>failure</strong> relationship as well which will ignore any error scenario. </p>
<p class="image-container"><img style="width: 434.00px" src="img/e2fb63b28d55ac7.png"></p>
<p>After you click on <strong>Apply</strong> and return to the canvas, you should only have a single configuration message being displayed now when you hover over the invalid icon.</p>
<p class="image-container"><img style="width: 621.00px" src="img/18f286036b2c20c4.png"></p>
<h2 is-upgraded><strong>Connections</strong></h2>
<p>As we need to have a processor to assign the <strong>success</strong> relationship to AND knowing our use case indicates we only want to process text files, go ahead and add another processor to the canvas. This time select the <code>RouteOnAttribute</code> processor type that has the following description.</p>
<p class="image-container"><img style="width: 549.00px" src="img/6f6690724a21ae96.png"></p>
<p>Make a connection to this new processor from the <strong>UnpackContent</strong> one and select the <strong>success</strong> relationship on the <strong>Create Connection</strong> window.</p>
<p class="image-container"><img style="width: 404.50px" src="img/77c44a89100e845d.png"></p>
<h2 is-upgraded><strong>Queues</strong></h2>
<p>The lower part of your pipeline should look like this.</p>
<p class="image-container"><img style="width: 380.00px" src="img/a74a5f7f00c44994.png"></p>
<p>This shows the original FlowFile with 2.14 MB of content is still in the queue backing the connection coming into <strong>UnpackContent</strong>. </p>
<h2 is-upgraded><strong>Aren&#39;t they the same thing?</strong></h2>
<p>It might sound like there are a lot of terms that really mean the same thing, but let&#39;s unpack them right now before we move on.</p>
<ul>
<li><em>Relationships</em> are the output paths a FlowFile can be emitted through from a processor</li>
<li><em>Connections</em> are the coupling of a producing processor&#39;s relationship with a consuming processor</li>
<li><em>Queues</em> hold the FlowFiles until the consuming processor can perform its action</li>
</ul>
<p>Easy-peasy! ;) Well, to make it more fun...</p>
<ul>
<li>Every processor produces 1, or more, relationships</li>
<li>Each relationship can have multiple connections as multiple processors can consume each relationship</li>
<li>Each connection can be configured to handle more than one relationship</li>
</ul>
<p>But, we&#39;ll keep it easy as this is the &#34;intro&#34; tutorial!</p>
<h2 is-upgraded><strong>Process the first queue</strong></h2>
<p>Start the <strong>UnpackContent</strong> processor and notice the FlowFiles coming into it will be cleared.</p>
<p class="image-container"><img style="width: 243.00px" src="img/19de8b818b97e4ef.png"></p>
<p>Also notice there are 43 FlowFiles in the queue backing the connection leaving this processor.</p>
<p class="image-container"><img style="width: 244.00px" src="img/204a68eb36476637.png"></p>
<p>These represent the 43 files we saw earlier that were included in the original zip file. The 5.31 MB is the byte size of all of the unzipped files. Execute the <strong>List Queue</strong> feature and see that all 43 of the files are listed along with their physical filename and size.</p>
<p class="image-container"><img style="width: 624.00px" src="img/3f10c8b114ab5d83.png"></p>
<aside class="special"><p><strong>Note:</strong> Due to how your workstation allocates disk space for files, it is likely the file size will be slightly larger than the Datavolo UI reports.</p>
</aside>
<p>Verify the first few entries in the queue align with the filenames and sizes that you previously unzipped on your workstation.</p>
<h2 is-upgraded><strong>View content</strong></h2>
<p>One way to view the contents of the binary data tied to the FlowFile is to click on the <strong>vertical ellipsis</strong> to the far right of the items in the <strong>List Queue</strong> output. From there, click on <strong>View content</strong>.</p>
<p class="image-container"><img style="width: 214.00px" src="img/c71b94fc5ff9e75b.png"></p>
<p>If the binary data is of a content type that Datavolo UI can visualize, it will be presented in a new browser tab.</p>
<p class="image-container"><img style="width: 624.00px" src="img/baa39915b1bdbac2.png"></p>
<p>Close the newly opened browser tab when done reviewing the content.</p>
<p>The <strong>View</strong> and <strong>Download</strong> options are also available if you select <strong>View Details</strong> from the <strong>vertical ellipsis</strong> via the buttons at the bottom of the <strong>Content Claim</strong> section of the <strong>FlowFile</strong> pop-up window that surfaces.</p>
<p class="image-container"><img style="width: 624.00px" src="img/8a1aaf76a9673f14.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Make routing decisions" duration="5">
        <h2 is-upgraded><strong>Routing options</strong></h2>
<p>With FlowFiles containing a reference to some binary content (such as the files we have been retrieving so far) AND attribute key-value pairs it is easy to imagine that making decisions on how a particular FlowFile is processed could depend on information in the content and/or the attributes.</p>
<p>For this initial flow we have to make decisions around the type of underlying content (i.e. text file or not) as well as the size of each. At first, that might suggest we need to start making routing decisions based on the binary content itself. Fortunately, there are attributes that already provide us with an easier way to answer these questions.</p>
<h2 is-upgraded><strong>Route on attribute</strong></h2>
<p>Let&#39;s review the documentation for the <strong>RouteOnAttribute</strong> processor that is already in our flow.</p>
<aside class="special"><p><strong>Note:</strong> In addition to retrieving processor documentation within the UI, <a href="https://docs.datavolo.io/" target="_blank">Datavolo Documentation</a> also provides this same information. It also includes additional Datavolo-only processors you will cover in other tutorials. <a href="https://docs.datavolo.io/docs/runtime-components/processors/routeonattribute" target="_blank">RouteOnAttribute | Datavolo Documentation</a> is a good example of this additional documentation source.</p>
</aside>
<p>Pull up the <strong>Edit Processor</strong> window for <strong>RouteOnAttribute</strong> and navigate to the <strong>Relationships</strong> tab. You will see there is only a single relationship present; <strong>unmatched</strong>.</p>
<p class="image-container"><img style="width: 494.00px" src="img/2bde6f56aec4cfd1.png"></p>
<p>The message below the checkboxes suggests that we can provide some logic of our own to make routing decisions. The documentation confirms this in the <strong>Dynamic Properties</strong> and <strong>Dynamic Relationships</strong> sections. </p>
<p>Simply stated this means we can add a custom property and set its value to a user-defined expression that returns a boolean response. Any FlowFile that causes the expression to return true will then be routed down a dynamic relationship named after the custom property.</p>
<p>For our initial routing decision, our requirements tell us to &#34;filter out any non-text file for additional investigation&#34;. Let&#39;s tackle the implementation for this step-by-step.</p>
<h3 is-upgraded><strong>Determine criteria</strong></h3>
<p>Back in the <strong>List Queue</strong> screen, click on the <strong>vertical ellipsis</strong> to the far right of one of the FlowFiles and select <strong>View Details</strong>.</p>
<p class="image-container"><img style="width: 624.00px" src="img/d262275b6c99191d.png"></p>
<p>Navigate to the <strong>Attributes</strong> table and find the <strong>filename</strong> attribute. Notice the file name has an extension. Likely your&#39;s shows <code>.txt</code> as below, but not guaranteed.</p>
<p class="image-container"><img style="width: 608.00px" src="img/7195a980faba870d.png"></p>
<p>Next, we will write an expression that determines if the anticipated file extension is present.</p>
<h3 is-upgraded><strong>Dynamic property</strong></h3>
<p>In the <strong>Properties</strong> tab of <strong>Edit Processor</strong> for the <strong>RouteOnAttribute</strong> processor, click on the <strong>+</strong> sign at the top right of the list of properties.</p>
<p class="image-container"><img style="width: 544.50px" src="img/527452051e81d418.png"></p>
<p>Enter <code>isText</code> in the <strong>Property Name</strong> field that surfaces in the <strong>Add Property</strong> pop-up window. </p>
<p class="image-container"><img style="width: 303.00px" src="img/4de49d9df3c62890.png"></p>
<p>Click <strong>Ok</strong> to save it. </p>
<h3 is-upgraded><strong>Expression language</strong></h3>
<p>You will automatically be routed into the property editor for this new dynamic (i.e. custom) property. Enter the following string into the editor.</p>
<pre><code>${filename:endsWith(&#39;.txt&#39;)}</code></pre>
<p class="image-container"><img style="width: 624.00px" src="img/307cdbfa29aad227.png"></p>
<aside class="special"><p><strong>Note:</strong> Similar expressions are shown in the <strong>Example Use Cases</strong> section of the processor. Furthermore, the syntax for these code-snippets are documented in the <a href="https://nifi.apache.org/documentation/nifi-2.0.0-M4/html/expression-language-guide.html" target="_blank">Apache NiFi Expression Language Guide</a>. An exhaustive review of this language guide is out of scope of this initial tutorial. When additional expression language code-snippets are needed in this tutorial, they will be provided.</p>
</aside>
<p>Click <strong>Ok</strong> to save the expression language and you will then see the new <strong>isText</strong> property listed.</p>
<p class="image-container"><img style="width: 514.00px" src="img/929b3c391cd340ee.png"></p>
<h3 is-upgraded><strong>Routing strategy</strong></h3>
<p>Click on the value for the only required property, <strong>Routing Strategy</strong>, and its options are presented in the <strong>Value</strong> pulldown menu. The information in the tooltips that surface also help in explaining the options.</p>
<p class="image-container"><img style="width: 624.00px" src="img/787f05f5b87f6c38.png"></p>
<p>Leave the <strong>Routing Strategy </strong>property set to <strong>Route to Property name</strong>. This will guarantee that any FlowFile meeting the criteria from the <strong>isText</strong> custom property will be routed to a newly created dynamic relationship.</p>
<h3 is-upgraded><strong>Verify relationships</strong></h3>
<p>Notice in the <strong>Relationships</strong> tab that we now have a new dynamic relationship called <strong>isText</strong> in addition to the existing <strong>unmatched</strong> one.</p>
<aside class="warning"><p><strong>Caution:</strong> You must save the <strong>Edit Processor</strong> pop-up and then reopen it to see the newly created dynamic relationship.</p>
</aside>
<p class="image-container"><img style="width: 489.00px" src="img/1264b587ee3446ee.png"></p>
<h3 is-upgraded><strong>Rename the processor</strong></h3>
<p>To make our dataflow more readable, rename the processor to something more meaningful. In the <strong>Settings</strong> tab and change the <strong>Name</strong> to <code>Verify Text File</code> and be sure to click <strong>Apply</strong> to save the all the processor configuration changes you have made.</p>
<p class="image-container"><img style="width: 200.00px" src="img/a0849f8c48032ac0.png"></p>
<h2 is-upgraded><strong>Resolve the relationships</strong></h2>
<p>It might sound like we are about to become marriage counselors, but we really just need to address the 2 relationships from <strong>RouteOnAttribute</strong>, so let&#39;s make sure we have a visual component for each to be connected to.</p>
<h3 is-upgraded><strong>Happy path</strong></h3>
<p>In our requirements, the &#34;happy path&#34; is to continue to process the <code>.txt</code> files. Add another <strong>RouteOnAttribute</strong> processor, rename it to <code>Check fileSize</code>, and then create a connection to it from the prior processor&#39;s <strong>isText</strong> relationship. Yes, you can do this without any hand holding! It should look like this once you have completed these steps.</p>
<p class="image-container"><img style="width: 353.00px" src="img/ddf6f50f2930a1ea.png"> </p>
<h3 is-upgraded><strong>Address errors</strong></h3>
<p>For fun, the zip file we are testing with has at least one file inside it that is not a text file. Our requirements simply stated to set these aside for &#34;additional investigation&#34;. These errors are in the <strong>unmatched</strong> relationship we reviewed previously. That is the relationship that still needs to be taken care of to get our <strong>Verify Text File</strong> processor out of its current invalid state.</p>
<p class="image-container"><img style="width: 599.00px" src="img/1c0980a59df799a9.png"></p>
<p>We previously found out how to auto-terminate a relationship, but if we do that in this situation we will lose visibility to any FlowFile that might be assigned to this relationship. We need to connect it to another component. Maybe we can use that <strong>Funnel</strong> component type in the palette? </p>
<p class="image-container"><img style="width: 622.00px" src="img/a17a87dff078e690.png"></p>
<p>While SURELY NOT the intended usage of a Funnel (yes... let&#39;s tackle it in another tutorial) it is a somewhat common practice in initial dataflow construction to use a Funnel for such a reason. Drag one onto the canvas and connect the <strong>unmatched</strong> relationship to it.</p>
<p class="image-container"><img style="width: 624.00px" src="img/438c3192187a3c4c.png"></p>
<p>If you did it right, the <strong>yellow triangle</strong> next to the <strong>Verify Text File</strong> processor changed to a <strong>red square</strong> which indicates it is not running, but that it is eligible to be started.</p>
<h2 is-upgraded><strong>Run it!</strong></h2>
<p>Take advantage of all your hard work by starting <strong>Verify Text File</strong> (i.e. right click on it for this option to surface) and watch those 43 FlowFiles queued into it flow down into the queues backing the connections addressing the <strong>isText</strong> and <strong>unmatched</strong> relationships.</p>
<p class="image-container"><img style="width: 624.00px" src="img/d83dd86829236f3f.png"></p>
<p>Spot-check a few of the 42 FlowFiles flowing through <strong>IsText</strong>. Afterwards, do the same to see what the single FlowFile is in <strong>unmatched</strong>.</p>
<p class="image-container"><img style="width: 624.00px" src="img/b585992736217489.png"></p>
<p>Aha! It is a striking image of The Bard himself. Very nice! </p>
<p>We have done enough &#34;additional investigation&#34; on this image that we can simply dismiss it. A very useful feature, especially when initially developing, testing, and debugging a dataflow, is to delete the contents of a queue.  Simply right click on the queue and select <strong>Empty Queue</strong> from the bottom of the contextual menu that surfaces.</p>
<p class="image-container"><img style="width: 435.00px" src="img/ad8cf6e60b51d94b.png"></p>
<p>Maybe Hamlet could have said, &#34;To queue, or not to queue: that is the question&#34;, but who are we to doubt the accomplished Bill Shakespeare?</p>
<aside class="special"><p><strong>Note:</strong> Don&#39;t do it now, but know that if you right click on an empty area of the canvas an <strong>Empty All Queues</strong> option is available at the bottom of the contextual menu that surfaces.</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Create an attribute" duration="5">
        <p>As a reminder, our transform requirements include classifying the text files based on their content&#39;s byte count. The following categories were declared.</p>
<ul>
<li><code>small</code> – when file size is &lt;= 75 KB</li>
<li><code>medium</code> – files &gt; 75 KB and &lt;= 150 KB</li>
<li><code>large</code> – any file &gt; 150 KB</li>
</ul>
<h2 is-upgraded><strong>Take care of the small files</strong></h2>
<p>We can address the small files scenario first and then later repeat it for medium and large sized ones.</p>
<h3 is-upgraded><strong>RouteOnAttribute (again)</strong></h3>
<p>Let&#39;s use the <strong>RouteOnAttribute</strong> processor that we already added to the flow and renamed to <strong>Check fileSize</strong> to tackle the first part of this. Like before, create a dynamic property named <strong>small</strong> with the following expression language.</p>
<pre><code>${fileSize:le(75000)}</code></pre>
<p>It should look like the following.</p>
<p class="image-container"><img style="width: 616.00px" src="img/bced29f71c463fb8.png"></p>
<p>Verify a dynamic relationship with the same name is now present.</p>
<aside class="special"><p><strong>Note:</strong> You must save the <strong>Edit Processor</strong> pop-up and then reopen it to see the newly created dynamic relationship.</p>
</aside>
<p class="image-container"><img style="width: 197.00px" src="img/5e9db8624f78887c.png"></p>
<p>This only routes the small files down a specific relationship. We still need to add an attribute to the FlowFile to be leveraged at the end of the dataflow.</p>
<h3 is-upgraded><strong>UpdateAttribute</strong></h3>
<p>You might think we can just use something that would be called <strong>AddAttribute</strong>, but no such processor exists. Fortunately, <strong>UpdateAttribute</strong> comes to the rescue and acts in an up-sert model by either creating or updating FlowFile attributes. </p>
<aside class="special"><p><strong>Note:</strong> We won&#39;t explore it now, but <strong>UpdateAttribute</strong> can also delete attributes.</p>
</aside>
<p>Add one to the flow, rename it to <code>Set contentSize to small</code>, and then make a connection to it with the <strong>small</strong> relationship from <strong>Check fileSize</strong>. This part of the dataflow should resemble the following.</p>
<p class="image-container"><img style="width: 624.00px" src="img/cec00a040977c680.png"></p>
<p>The <strong>Dynamic Properties</strong> section of the <strong>UpdateAttribute</strong> documentation explains we can simply add a new custom property whose name will be used to create an attribute with the same name. The property value will then become the value of the attribute as well.</p>
<p class="image-container"><img style="width: 282.00px" src="img/ff5b62ae68a854f6.png"></p>
<p>Add a property named <strong>contentSize</strong> and set it to <code>small</code>.</p>
<p class="image-container"><img style="width: 583.00px" src="img/eeb5f244a24d385c.png"></p>
<h2 is-upgraded><strong>Repeat for medium and large files</strong></h2>
<p>Perform the same general steps to account for the medium and large scenarios.</p>
<h3 is-upgraded><strong>RouteOnAttribute</strong></h3>
<p>Add a <strong>medium</strong> property to the existing <strong>Check fileSize</strong> processor with the following expression language.</p>
<pre><code>${fileSize:gt(75000):and(${fileSize:le(150000)})}</code></pre>
<p>And another property called <strong>large</strong> with the following value.</p>
<pre><code>${fileSize:gt(150000)}</code></pre>
<p>Three custom properties should now be present.</p>
<p class="image-container"><img style="width: 624.00px" src="img/b121c2a61959a856.png"></p>
<aside class="warning"><p><strong>Caution:</strong> A common error that surfaces when using expression language in a property editor is unwanted spaces before and/or after the value. A small <strong>blue information icon</strong> may be present with the following tooltip to alert you to this situation..</p>
<p class="image-container"><img style="width: 610.00px" src="img/e3a60cbc97dcc2b2.png"></p>
</aside>
<p>Save and reopen the <strong>Edit Processor</strong> pop-up and verify all 3 dynamic relationships are present.</p>
<p class="image-container"><img style="width: 197.00px" src="img/2172bc1f214cb66b.png"></p>
<h3 is-upgraded><strong>UpdateAttribute</strong></h3>
<p>Reuse the pattern from the <strong>small</strong> relationship for this step. Create two new <strong>UpdateAttribute</strong> processors for the <strong>medium</strong> and <strong>small</strong> relationships. Modify the <strong>UpdateAttribute</strong> processors with the appropriate <code>medium</code> or <code>large</code> value for a <strong>contentSize</strong> custom property. </p>
<p>This part of the dataflow should be similar to the following now.</p>
<p class="image-container"><img style="width: 624.00px" src="img/2e7550cd727595b9.png"></p>
<p>Hovering over the <strong>yellow triangle</strong> in <strong>Check fileSize</strong> should indicate one remaining configuration issue.</p>
<p class="image-container"><img style="width: 612.00px" src="img/6c960b35cd788412.png"></p>
<p>Any FlowFiles going to the <strong>unmatched</strong> relationship would indicate we have a logic problem in <strong>Check fileSize</strong>. Connect it to the <strong>Funnel</strong> we previously added to the dataflow. This will allow us to notice any bugs that might surface.</p>
<p class="image-container"><img style="width: 624.00px" src="img/7e1932d432e3212b.png"></p>
<h2 is-upgraded><strong>Run it!</strong></h2>
<p>Start <strong>Check fileSize</strong> to see the 42 FlowFiles queued into it flow down into the queues backing the connections addressing the <strong>small</strong>, <strong>medium</strong>, and <strong>large</strong> relationships.</p>
<p class="image-container"><img style="width: 624.00px" src="img/3b1e13d523afc007.png"></p>
<p>Perfect results so far! All 42 FlowFiles left the <strong>isText</strong> queue, were processed through <strong>Check fileSize</strong> (with 0 <strong>unmatched</strong> issues) and were distributed across the 3 relationships you created.</p>
<p><a href="https://www.waltongas.com/how-deke-and-bob-started-cooking-with-gas/" target="_blank">Now we&#39;re cooking with gas!</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Load to S3" duration="8">
        <p>You&#39;ve already tackled the E and T of the ETL pipeline requirements, so time to finish up the L and wrap the tutorial up! </p>
<p class="image-container"><img style="width: 624.00px" src="img/e3237f88fa29cbd4.png"></p>
<h2 is-upgraded><strong>Route back to a single processor</strong></h2>
<p>Add a <strong>PutS3Object</strong> processor on the canvas and connect all 3 of the <strong>Set contentSize to ...</strong> processor&#39;s <strong>success</strong> relationships to it.</p>
<aside class="special"><p><strong>Note:</strong> When there is only a single relationship coming out of a processor, the relationship checkbox will automatically be selected when creating a connection.</p>
</aside>
<p class="image-container"><img style="width: 609.00px" src="img/3618278c5f90793c.png"></p>
<p>This shows that a single processor can tackle connections from multiple processors. In fact, it could tackle multiple relationships on each connection if that made sense for a flow. This is technically sound, but there is a generally more preferred approach to a scenario like this.</p>
<h2 is-upgraded><strong>A better use of a funnel</strong></h2>
<p>Previously we used a <strong>Funnel</strong> as a way to set aside FlowFiles to allow us to investigate them further. A more appropriate use of a <strong>Funnel</strong> is the situation we have above – multiple connections with similar data that have subtle differences such as attribute values. </p>
<p>First, delete the 3 connections entering <strong>PutS3Object</strong>.</p>
<aside class="warning"><p><strong>Caution:</strong> A connection that contains any FlowFiles in its backing queue cannot be deleted. You can use the <strong>Empty Queue</strong> feature and then delete the connection.</p>
</aside>
<p>Now, add a <strong>Funnel</strong> just above <strong>PutS3Object</strong> and rebuild the 3 previous connections. This time connect them to the new <strong>Funnel</strong>. Finish up the flow by making a connection from the <strong>Funnel</strong> to the <strong>PutS3Object</strong> processor.</p>
<p>Notice that there are no relationship choices when connecting the <strong>Funnel</strong> to <strong>PutS3Object</strong>. All FlowFiles flow into the connection being made. </p>
<p class="image-container"><img style="width: 624.00px" src="img/3980751bae084b3c.png"></p>
<p>For those asking... yes, another connection from that same <strong>Funnel</strong> can be made to additional processors. Try it for fun, <em>but remember to remove the extra processor and connection when you are done experimenting.</em></p>
<p>The bottom part of your dataflow should look like this now. Notice the unnamed connection (remember, there are no named relationships to choose from) from the <strong>Funnel</strong>.</p>
<p class="image-container"><img style="width: 609.00px" src="img/e0f39db1f332559d.png"></p>
<p>Start <strong>Set contentSize to small</strong> and see its 2 FlowFiles now queued up between the <strong>Funnel</strong> and <strong>PutS3Object</strong>. Run <strong>Set contentSize to medium</strong> and see that total go to 30. Finally, run <strong>Set contentSize to large</strong> to allow all 42 FlowFiles to be queued up below the <strong>Funnel</strong>.</p>
<p class="image-container"><img style="width: 414.00px" src="img/26a2da27496e014e.png"></p>
<aside class="special"><p><strong>Note:</strong> While Funnels help make most flows more readable their secret sauce is that you can prioritize FlowFlows via one, or more, strategies to control which FlowFiles are processed first when there is more than 1 FlowFile in the queue. Yep... ANOTHER tutorial for sure!</p>
</aside>
<h2 is-upgraded><strong>Persist the files</strong></h2>
<p>For you to finalize the configuration of the <strong>PutS3Object</strong> processor, you will need an existing S3 bucket and appropriate credentials to write to it. If you do not have these available you can still complete most of this final step. You just won&#39;t be able to run the processor, but you&#39;ll still get the gist of what&#39;s happening.</p>
<h3 is-upgraded><strong>BYOB</strong></h3>
<p>As just mentioned, you will need to <em>Bring Your Own Bucket</em> to this party. </p>
<p>Here is my <strong>lestermartin.blog</strong> S3 bucket located in the <strong>us-east-2</strong> (Ohio) AWS region that I will be testing with. I have an empty &#34;folder&#34; named <strong>the-bard</strong> where the 42 files will be written to.</p>
<p class="image-container"><img style="width: 624.00px" src="img/cec555dac02cc8e0.png"></p>
<p>Go to the <strong>Edit Processor</strong> pop-up and select the <strong>Properties</strong> tab. Enter <em>YOUR</em> S3 bucket name as the value for the <strong>Bucket</strong> property. Choose the appropriate value for <strong>Region</strong>. Enter the following for <strong>Object Key</strong>. </p>
<pre><code>the-bard/${contentSize}/${filename}</code></pre>
<p>You can change <code>the-bard</code> to anything you like and the folder does not have to already exist in your S3 bucket. The <strong>contentSize</strong> and <strong>filename</strong> FlowFile attributes will be dynamically substituted for each FlowFile entering into the processor.</p>
<p>Here is an example of what the 4 properties that we need to focus on for this tutorial should look similar to.</p>
<p class="image-container"><img style="width: 624.00px" src="img/9d914b4ce79395d1.png"></p>
<p>Go ahead and click on <strong>Apply</strong> to save these configurations. Then open <strong>Edit Processor</strong> again and ensure you are on the <strong>Properties</strong> tab.</p>
<h3 is-upgraded><strong>Controller Services</strong></h3>
<p>The last property in the list above is for a Controller Service. The <a href="https://nifi.apache.org/documentation/nifi-2.0.0-M4/html/developer-guide.html#controller-services" target="_blank">Apache NiFi Documentation</a> states Controller Services &#34;share functionality and state&#34; for the benefit of processors. Here are two examples of these.</p>
<ul>
<li><a href="https://docs.datavolo.io/docs/runtime-components/controller-services/awscredentialsprovidercontrollerservice" target="_blank">AWSCredentialsProviderControllerService</a> - a Controller Service that maintains common configuration information for a specific AWS account</li>
<li><a href="https://docs.datavolo.io/docs/runtime-components/controller-services/dbcpconnectionpool" target="_blank">DBCPConnectionPool</a> - a Controller Service that maintains a pool of database connections that can be utilized by processors</li>
</ul>
<p>It is easy to see that common configuration properties as well as common runtime services are beneficial for maintainability as well as performance &amp; scalability. These Controller Services also keep sensitive configuration information secured.</p>
<p>Further discussion on this component type is beyond the scope of this tutorial. Fortunately, the answer to the question of &#34;when do I need to create a Controller Service&#34; is easily answered. If you NEED one, you&#39;ll find out easily enough as it will expose itself as a required parameter setting in one of your processors.</p>
<p>Back on the <strong>Properties</strong> tab, click on the <strong>vertical ellipsis</strong> to the right of the <strong>AWS Credentials Provider Service</strong> property and then select <strong>Create new service</strong>.</p>
<p class="image-container"><img style="width: 624.00px" src="img/1beff3b8624d2c8f.png"></p>
<p>This will bring up an <strong>Add Controller Service</strong> pop-up with the appropriate type preselected. Click <strong>Add</strong> in the bottom right corner to proceed.</p>
<p class="image-container"><img style="width: 624.00px" src="img/eb783b32ee75f03d.png"></p>
<p>You will return back to the <strong>Properties</strong> tab with the new property selected. Click the <strong>vertical ellipsis</strong> again and select <strong>Go to Service</strong> this time.</p>
<p class="image-container"><img style="width: 624.00px" src="img/471ffe1bbb2ec74a.png"></p>
<p>Click <strong>Yes</strong> when prompted to save processor changes. On the <strong>Controller Services</strong> page that renders, click on the <strong>vertical ellipsis</strong> on the far right of the entry and then <strong>Edit</strong>.</p>
<p class="image-container"><img style="width: 624.00px" src="img/c6344192bc961f5e.png"></p>
<p>On the <strong>Edit Controller Service</strong> pop-up navigate to the <strong>Properties</strong> tab. There are multiple ways to authenticate to AWS, but in my scenario I am modifying the <strong>Access Key ID</strong> and <strong>Secret Access Key</strong> values to my own private values. <em>This is the step you may not be able to complete if you do not have this preconfigured.</em></p>
<p class="image-container"><img style="width: 624.00px" src="img/fe9ee74725108544.png"></p>
<p>Click <strong>Apply</strong> to save the configuration changes and back on the <strong>Controller Services</strong> page click the <strong>vertical ellipsis</strong> again. This time select <strong>Enable</strong>.</p>
<p class="image-container"><img style="width: 624.00px" src="img/d1ae38b3d95835a5.png"></p>
<p>Click on <strong>Enable</strong> in the lower right corner on the <strong>Enable Controller Service</strong> pop-up which will output the following.</p>
<p class="image-container"><img style="width: 624.00px" src="img/d7a9c9a736d9859.png"></p>
<p>Click <strong>Close</strong> in the lower right corner to return to the <strong>Controller Services</strong> page where you will click on <strong>Back to Processor</strong> in the upper left of the page. That takes you back to <strong>Edit Processor</strong> (see... I told you we need to tackle Controller Services in another tutorial). </p>
<p>If <strong>Apply</strong> is enabled, click on it. Otherwise, click on <strong>Cancel</strong> as you likely saved the configuration changes to the processor itself previously. </p>
<p>Back on the canvas you&#39;ll see that the only configuration issues remaining are related to handling the 2 relationships this processor produces.</p>
<p class="image-container"><img style="width: 624.00px" src="img/9053a0c2b91d26af.png"></p>
<p>Auto-terminate the <strong>success</strong> relationship as this is the last thing we will do in our dataflow. Create a new <strong>Funnel</strong> and make a connection to it for the <strong>failure</strong> relationship so that we can be aware of any problems that may occur.</p>
<h3 is-upgraded><strong>Write it!</strong></h3>
<p>Now, start <strong>PutS3Object</strong> and verify all 42 FlowFiles left the incoming connection and we see the number 42 in the last metric which indicates that it successfully wrote all 42 files to the S3 bucket.</p>
<p class="image-container"><img style="width: 410.00px" src="img/9efbca15bebf04ce.png"></p>
<h2 is-upgraded><strong>Trust, but verify</strong></h2>
<p>Double-check to see if the files appropriately made it to your S3 bucket.</p>
<h3 is-upgraded><strong>3 folders</strong></h3>
<p>The small, medium, and large folders were created.</p>
<p class="image-container"><img style="width: 561.00px" src="img/90748e4d362122ca.png"></p>
<h3 is-upgraded><strong>2 small files</strong></h3>
<p class="image-container"><img style="width: 559.00px" src="img/91e6dcb60b426074.png"></p>
<h3 is-upgraded><strong>28 small files</strong></h3>
<p class="image-container"><img style="width: 563.00px" src="img/c5eae34785dc8d80.png"></p>
<h3 is-upgraded><strong>12 large files</strong></h3>
<p class="image-container"><img style="width: 560.00px" src="img/babd9e3e8991b231.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="The dataflow" duration="1">
        <h2 is-upgraded><strong>10,000 foot view </strong></h2>
<p>If you zoom out until you see the entire flow, it likely looks similar to this.</p>
<p class="image-container"><img style="width: 612.00px" src="img/65ece889feb6c5a3.png"></p>
<p>Datavolo&#39;s low-code solution is definitely different from just opening a code editor and starting to program in your favorite language. The real trick to get used to is knowing what your overall flow is (i.e. the forest) and being able to mentally zoom in and realize you are working with steps, sometimes micro-steps, (i.e. the trees) to fulfill the logic your dataflow needs.</p>
<h2 is-upgraded><strong>Less is more</strong></h2>
<p>It is easy to imagine that anything much more complex than our simple use case in this tutorial could visually be very complex. There are strategies, including using Process Groups like we nested our work into, to make dataflows more readable and maintainable and to even support multiple development teams tackle different aspects of a complete dataflow.</p>
<p>One rule of thumb is that the fewer processors a dataflow has, the better it will perform. One refactoring opportunity for the flow you just created would be to combine the work of the two <strong>RouteOnAttribute</strong> processors into one. Feel free to try to do this on your own if you are up for it.</p>
<aside class="special"><p><strong>Note:</strong> You cannot edit the configuration of a running processor. Simply stop it and then it will become editable.</p>
</aside>
<h2 is-upgraded><strong>We are here to help</strong></h2>
<p>There are literally hundreds of processors to allow you to tackle so many possible solutions, but don&#39;t let that overwhelm you. Count on Datavolo to help you be a <strong>10x Data Engineer for AI</strong>. Additional tutorials, <a href="https://docs.datavolo.io/docs/quickstart/showcase-flows" target="_blank">Showcase Flows</a>, webinars, podcasts, and more are being constantly created and updated to help you on your journey.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Tutorial wrap-up" duration="1">
        <p>Congratulations, you&#39;ve successfully built your first dataflow with Datavolo!  </p>
<p>EXPLAIN SPECIFICALLY WHAT WAS DONE IN THIS TUTORIAL</p>
<h2 is-upgraded><strong>What&#39;s next?</strong></h2>
<p>Check out some of these codelabs...</p>
<ul>
<li><a href="http://localhost:9090/datavolo-cloud/" target="_blank">Dataflow foundations</a></li>
</ul>
<h2 is-upgraded><strong>Further reading</strong></h2>
<ul>
<li>Something</li>
<li>Another thing</li>
<li>Maybe even another</li>
</ul>
<h2 is-upgraded><strong>Reference docs</strong></h2>
<ul>
<li><a href="https://docs.datavolo.io/" target="_blank">Datavolo Documentation</a></li>
<li><a href="https://nifi.apache.org/documentation/" target="_blank">Apache NiFi Documentation</a> </li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
